<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <script src="fabric.min.js"></script>

    <style>
        .canvas-wrapper {
            width: 800px;
            height: 600px;
            margin: 40px auto;
        }

        #c {
            border: 1px solid red;
        }
    </style>
</head>
<body>
    <div class="canvas-wrapper">
        <canvas id="c"></canvas>
    </div>
    <div style="display: inline-block; margin-left: 10px">
        <button id="deleteconexion" onclick="deleteconexion();" class="btn btn-info">Eliminar Conexion Seleccionada</button><br>
        <button id="addconexion" onclick="addconexion();" class="btn btn-info">Enlazar</button><br>

    </div>
</body>
</html>
<script>




</script>
<script>

    var palanca = 0;
    var newx1 = 0;
    var newy1 = 0;
    var newx2 = 0;
    var newy2 = 0;

    function makeLine(coords) {
        return new fabric.Line(coords, {
            fill: 'red',
            stroke: 'red',
            strokeWidth: 5,
            selectable: true
        });
    }
    function deleteconexion() {
        canvas.remove(canvas.getActiveObject());
    }

    function addconexion() {
        if (newx1 == 0 || newy2 == 0 || newx1 == 0 || newy2 == 0) {
            alert('selecciona antes');
        }
        else {
            alert(newx1 + '|' + newy1 + '|' + newx2 + '|' + newy2);
        }
        canvas.add(makeLine([newx1, newy1, newy2, newx2]));
        canvas.add(makeLine([207, 169, 206, 169]));

        //makeLine([250, 175, 175, 225])

        //new fabric.Line(coords, {
        //    fill: 'red',
        //    stroke: 'red',
        //    strokeWidth: 5,
        //    selectable: true
        //});

    }
    paint();

    function paint() {
        window.canvas = new fabric.Canvas('c');
        canvas.setWidth(800);
        canvas.setHeight(600);



        (function () {




            // var canvas = this.__canvas = new fabric.Canvas('c', { selection: false });
            fabric.Object.prototype.originX = fabric.Object.prototype.originY = 'center';

            function makeCircle(left, top) {
                var c = new fabric.Rect({
                    left: left,
                    top: top, fill: 'Green', width: 100, height: 50
                    //strokeWidth: 5,
                    //radius: 12,
                    //fill: '#fff',
                    //stroke: '#666'
                });
                c.hasControls = c.hasBorders = false;

                return c;
            }

            function makeLine(coords, conector1, conector2) {
                var l = new fabric.Line(coords, {
                    fill: 'red',
                    stroke: 'red',
                    strokeWidth: 5,
                    selectable: true
                });

                l.conector1 = conector1;
                l.conector2 = conector2;

                return l;
            }


            var cuadrotest = makeCircle(150, 250),
                cuadrotest2 = makeCircle(250, 175);



            var linetest = makeLine([cuadrotest.get('left'), cuadrotest.get('top'), cuadrotest2.get('left'), cuadrotest2.get('top')], cuadrotest, cuadrotest2); //line([x1, y1, x2, y2])

            canvas.add(linetest);
            canvas.add(cuadrotest, cuadrotest2);

            //var linea = makeLine([100, 125, 250, 175],cuadro1,cuadro2); //line([x1, y1, x2, y2])


           //canvas.add(linea);


            //var cuadro1 = makeCircle(line.get('x1'), line.get('y1')),
            //    cuadro2 = makeCircle(line.get('x2'), line.get('y2'));

            //canvas.add(cuadro1, cuadro2);



            canvas.on('object:moving', function (e) {
                var p = e.target;
                //p.line1 && p.line1.set({ 'x2': p.left, 'y2': p.top });
                //p.line2 && p.line2.set({ 'x1': p.left, 'y1': p.top });
                linetest && linetest.set({ 'x1': cuadrotest.left, 'y1': cuadrotest.top });
                linetest && linetest.set({ 'x2': cuadrotest2.left, 'y2': cuadrotest2.top });
                //p.conector1 && p.conector1.set({ 'x1': p.left, 'y1': p.top });
                //p.conector2 && p.conector2.set({ 'x1': p.left, 'y1': p.top });


                if (palanca == 0) {
                    //newx1 = p.set('left');
                    //newy1 = p.set('left');
                    palanca = 1;
                }
                else {
                    //newx2 = p.set('left');
                    //newy2 = p.set('left');
                    palanca = 0;
                }


                canvas.renderAll();
            });
        })();

        ///////////////FIN CONECTORES////////////////////

















        //var canvas = this.__canvas = new fabric.Canvas('c');


    }



</script>